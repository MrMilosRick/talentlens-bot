# TalentLens Bot — HR-скрининг Telegram-бот (MVP за 1 день)

Минимальный HR-скрининг на 3–5 минут: бот задаёт 6 вопросов + отдельный шаг с пруфами (всего 7 шагов: ссылка / NDA-описание / отказ), затем:
1) отправляет ответы в LLM,
2) получает **строго валидный JSON** по схеме (3 критерия + summary + hot),
3) пишет результат **одной строкой** в Google Sheet,
4) отправляет hot/ошибки в `ADMIN_ALERT_CHAT_ID`.

## Команды бота
- `/start` — начать скрининг
- `/restart` — начать заново
- `/cancel` — остановить

## Быстрый старт (локально)
Требования: Python 3.11+ (рекомендуется 3.11), Telegram Bot Token, OpenAI API key, Google Sheet + service account creds.

### 1) Установка
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 2) Конфигурация
Скопируй пример:
```bash
cp .env.example .env
```

Пример `.env`:
```dotenv
BOT_TOKEN=123456789:replace_me
ADMIN_USER_ID=123456789
ADMIN_ALERT_CHAT_ID=-1001234567890
LLM_MODEL=gpt-5-mini
OPENAI_API_KEY=replace_me

GOOGLE_SHEETS_ID=replace_me
GOOGLE_SHEETS_WORKSHEET=Sheet1
GOOGLE_CREDS_PATH=./creds.json
```

### 3) Запуск
```bash
python main.py
```

## Google Sheets (обязательно для DoD)
Мы пишем одну строку на прохождение. Бот автоматически создаёт шапку (row 1), если её нет/не совпадает.

### Как настроить creds.json (service account)
1) В Google Cloud создай проект
2) Включи APIs:
   - Google Sheets API
   - Google Drive API
3) IAM & Admin → Service Accounts → Create
4) Keys → Add Key → Create new key → JSON → скачать
5) Сохрани файл как `./creds.json` рядом с проектом
6) Открой `creds.json`, скопируй `client_email`
7) В Google Sheet нажми **Share** и добавь этот email с правами **Editor**

### Колонки (порядок записи)
В шапке будут:
1. `timestamp_utc_iso` — UTC ISO timestamp
2. `tg_user_id`
3. `username`
4. `full_name`
5. `answers_json`
6. `project_link` — `https://...` или `declined` или `nda`
7. `project_note` — текст NDA-описания (если был)
8. `scores_json` — валидный JSON скоринга
9. `overall_score` — 0..10
10. `hot` — TRUE/FALSE
11. `llm_model`
12. `latency_ms`
13. `scoring_failed` — TRUE/FALSE (только ошибки LLM)
14. `error` — текст ошибки (если был)

## AI-скоринг: что делает AI и зачем он тут
Цель — превратить свободные ответы кандидата в **структурированную оценку**, которую можно сравнивать между кандидатами и быстро просматривать рекрутеру.

LLM оценивает ответы по 3 критериям (каждый 0..10) и возвращает JSON строго по схеме:
- `criteria` (ровно 3 элемента)
- `overall_score_0_10`
- `hot`
- `summary_1_2_lines`

Правило:
- `overall_score_0_10 = round(mean(criteria scores))`
- `hot = (overall>=8) OR (минимум 2 критерия>=8)`

Если LLM вернул невалидный JSON → 1 ретрай "return valid JSON only" → при повторной ошибке ставим `scoring_failed=true`, пишем строку в Sheet и отправляем alert в `ADMIN_ALERT_CHAT_ID`.

## Сценарий скринкаста (3–5 минут)
1) Показать `.env` (без токенов) и структуру проекта
2) Запуск `python main.py` → видно polling
3) Telegram: `/start` → правила → 1–2 вопроса (быстро), затем ускоренно пройти остальные
4) На шаге 7 показать 2 кейса валидации:
   - отправить "github.com" → бот попросит http/https или "не хочу"
   - отправить NDA-текст → бот примет и продолжит
5) Финал: "Спасибо! Готово."
6) Открыть Google Sheet → показать новую строку (answers_json, scores_json, overall, latency)
7) Показать admin-alert (hot/ошибка). Если hot не сработал — ок; важно показать, что алерты живые.

## Как узнать свой Telegram ID
1) Запусти бота локально.
2) Пройди `/start` до конца.
3) Открой Google Sheet.
4) В колонке `tg_user_id` появится твой ID.
5) Используй его как значение `ADMIN_USER_ID` в `.env`.

---

## Почему именно такие вопросы? (Методология скрининга)

Цель этого опросника — за 10 минут отсечь «туристов», которые просто умеют открывать ChatGPT, и выявить AI-first разработчиков. Мы ищем людей, которые понимают капризную природу LLM и умеют строить вокруг них надежные инженерные системы.

### 1. Проверка на «инженерную гигиену» (Q1, Q2)
Первые два вопроса проверяют, стал ли AI частью повседневного рабочего процесса.  
**Зачем:** Если разработчик не использует AI для ускорения собственной работы, он вряд ли сможет эффективно внедрять его в продукт.  
**Что ищем:** Переход от простых текстовых запросов к системному подходу (структурированный ввод/вывод, использование JSON-mode, Pydantic, понимание того, как «зажать» модель в рамки задачи).

### 2. Зрелость и работа с неопределенностью (Q3)
LLM по определению вероятностны. Вопрос про фейлы — это лакмусовая бумажка опыта.  
**Зачем:** Новички верят модели на слово. Опытные разработчики знают, что модель обязательно ошибется.  
**Что ищем:** Понимание концепций Guardrails (предохранителей), логирования, цепочек проверок и стратегий отката (fallbacks).

### 3. Отказ от «Vibe Check» в пользу метрик (Q4)
Самая большая проблема AI-разработки — оценка качества («вроде отвечает нормально»).  
**Зачем:** Мы ищем продукт-ориентированное мышление. Разработчик должен уметь превращать субъективное ощущение ответа в измеримые данные.  
**Что ищем:** Упоминание бенчмарков, циклов обратной связи (feedback loops), использования других LLM для оценки (LLM-as-a-judge) или конкретных продуктовых метрик.

### 4. Прагматичность и доставка ценности (Q5)
Разработка на AI часто превращается в бесконечный R&D. Нам важна скорость.  
**Зачем:** Проверяем способность быстро собрать MVP, не закапываясь в дообучение (fine-tuning) там, где достаточно хорошего промпта.  
**Что ищем:** Умение расставлять приоритеты — что можно «захардкодить» или упростить, а где критически важна точность.

### 5. Хард-скиллы и ограничения (Q6)
Работа с API OpenAI — это только верхушка айсберга. Реальный бизнес часто ограничен безопасностью и бюджетом.  
**Зачем:** Проверяем технический кругозор. Знает ли кандидат, что делать, если «облако» запрещено или слишком дорого стоит.  
**Что ищем:** Знание open-source моделей (Llama, Mistral), понимание RAG-архитектуры, векторных баз данных или способов квантования моделей для запуска на своем железе.

### 6. Артефакты и контекст (Q7)
Финальный шаг — это переход от слов к делу.  
**Зачем:** Нам нужны либо доказательства кода, либо четкое описание архитектурной мысли. Даже если проект под NDA, то, как человек описывает стек и логику решения, дает интервьюеру 80% информации для принятия решения о следующем этапе.

## Безопасность данных
Мы сохраняем только минимальные поля для скрининга (tg_user_id, username, имя, ответы, ссылка/описание, скоринг). Секреты (BOT_TOKEN/OPENAI_API_KEY/creds.json) в репозиторий не коммитим.
